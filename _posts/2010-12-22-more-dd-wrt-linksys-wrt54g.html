---
title: "More DD-WRT / Linksys WRT54G troubleshooting"
layout: "post"
permalink: "/2010/12/more-dd-wrt-linksys-wrt54g.html"
uuid: "463540960054595302"
guid: "tag:blogger.com,1999:blog-4675781771561437973.post-463540960054595302"
date: "2010-12-22 00:45:00"
updated: "2010-12-22 00:45:11"
thumbnail: "http://2.bp.blogspot.com/_Ukp9db12h9g/TRE86KWHPjI/AAAAAAAAAAQ/bdvCijKJhdA/s72-c/Pings+over+time.png"
description: 
blogger:
    siteid: "4675781771561437973"
    postid: "463540960054595302"
categories: [wrt54g, diagnosis, wifi, dd-wrt]
comments: true
---

{% raw %}
<div class="css-full-post-content js-full-post-content">
After my evening spent <a href="http://swearingatcomputers.blogspot.com/2010/12/dd-wrt-versioning-and-linksys-wrt54g.html">getting my DD-WRT firmware to a stable version</a> (as opposed to the version recommended by the DD-WRT website), I had hoped that I had seen the end of my wireless issues.<br /><br />No such luck.<br /><br />I have definitely seen an improvement - in a ping flood test, I'm only seeing 0.5% dropped packets now, which is an improvement over the 2% I was seeing before. &nbsp;But there are still periodic ping spikes where I drop a packet, then get something like an ~1100ms ping, then ~110ms, then back to normal at ~2ms. &nbsp;I tried leaving a ping running in the background today, and every Skype audio drop was accompanied by a dropped packet. &nbsp;So I'm going with correlation = causation and assuming that these periodic spikes which are causing my Skype audio drops. <br /><br />The first thing to do is understand the nature of the beast. &nbsp;So I graphed my pings:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_Ukp9db12h9g/TRE86KWHPjI/AAAAAAAAAAQ/bdvCijKJhdA/s1600/Pings+over+time.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="467" src="http://2.bp.blogspot.com/_Ukp9db12h9g/TRE86KWHPjI/AAAAAAAAAAQ/bdvCijKJhdA/s640/Pings+over+time.png" width="640" /></a></div><br />What's interesting about this chart is not that Excel makes it difficult to label your axes. &nbsp;Excel is a pain in the ass sometimes, there's no revelation there.<br /><br />I'm looking for patterns here. &nbsp;With one ping per second, my timeouts occur for packets 91, 128, 158, 160, 171, 199, 214, 219, 259, 274, and 366. &nbsp;The ping spikes occurred at 91, 183, 274, and 366. &nbsp;Note that dropped packets don't count, so the spike at packet 91 is really after the one failed attempt for packet 91. <br /><br />Well, there's definitely a pattern in the ping spikes - I get pings of &gt;800ms every 90 seconds or so. &nbsp;So one problem is happening every minute and a half. &nbsp;The other problem starts after that first dropped packet, where I drop a packet every 10-20 seconds.<br /><br />The first culprit to suspect is always wireless interference, and sure enough, the vast majority of my neighbors are sharing channel 6 (2.437 Ghz range) with me. &nbsp;Here's a handy chart I used to work out the best channel to avoid my neighbors' traffic.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_Ukp9db12h9g/TRFBGIzQE_I/AAAAAAAAAAU/1CSgfS9bANU/s1600/Wifi+channel_chart.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="377" src="http://2.bp.blogspot.com/_Ukp9db12h9g/TRFBGIzQE_I/AAAAAAAAAAU/1CSgfS9bANU/s640/Wifi+channel_chart.gif" width="640" /></a></div><br />Most of my neighbors are on 6 or 11, with a couple on 3. &nbsp;So I chose channel 1. &nbsp;This seemed to cut out a lot of the 10 second interval drops. &nbsp;Next I disabled the SPI firewall, to make sure I was minimizing the processing required for each packet. &nbsp;Here's my ping graph after the change:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/_Ukp9db12h9g/TRFEJRnfMmI/AAAAAAAAAAY/e0vQoZ-LT7w/s1600/pings+over+time+2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="462" src="http://2.bp.blogspot.com/_Ukp9db12h9g/TRFEJRnfMmI/AAAAAAAAAAY/e0vQoZ-LT7w/s640/pings+over+time+2.png" width="640" /></a></div><br /><br />As you can see, no more problem with dropped packets every 10-20 seconds, but I still get enormous ping spikes every 90 seconds, which resulted in only one dropped packet. &nbsp;Hey, it's improvement! &nbsp;Another interesting element is that the ping spikes actually improved over time, while my average ping was significantly higher (23ms vs 19ms). &nbsp;I'm going with chance fluctuation on that one, I don't have a good explanation for it. &nbsp;(note - I was using the web interface for the router at the time, and loaded up diagnostic pages for the two smaller spikes... so I'm not worried about them)<br /><br />So I had a look at DD-WRT's own diagnostic pages, and noticed that the errors it was aware of were <b>all</b>&nbsp;transmit errors. The number one and two causes of transmit errors are too high ACK timing and too high transmit power. &nbsp;Dropping the ACK to 0 and setting transmit power to the (factory) 22mW didn't help. <br /><br />So now I'm stuck. &nbsp;I definitely got some benefit here, though I'm not too happy that my average ping rose like that. &nbsp;But every 90 seconds SOMETHING happens that breaks my wireless connection. &nbsp;I'm going to puzzle over this for awhile.
</div>
{% endraw %}
